# v0.6.0 API Issues - README vs Implementation

## Critical Issue: API Signature Mismatch

The README examples show an OLD API that doesn't match v0.6.0 implementation.

### Published v0.6.0 API (Actual)

```javascript
// ‚úÖ CORRECT v0.6.0 API
const result = await runLocalCitty({
  args: ['--help'],           // ‚Üê args is a PROPERTY of the options object
  cwd: './my-project',
  cliPath: 'src/cli.mjs',     // ‚Üê cliPath is REQUIRED
  env: { DEBUG: 'true' },
  timeout: 30000
})
```

### README Examples (Incorrect for v0.6.0)

```javascript
// ‚ùå WRONG - This is the v0.5.1 API shown in README
const result = await runLocalCitty(['--help'], {  // ‚Üê args as first parameter (WRONG!)
  cwd: './my-project',
  env: { DEBUG: 'true' }
})
```

## Impact

**ALL README examples are broken** for users who install v0.6.0:

1. **Quick Start** (line 76-88) - Broken
2. **Scenario DSL** (line 91-103) - Broken
3. **Local Runner** (line 302-314) - Broken
4. **All Testing API examples** (line 423-906) - Broken

## Root Cause

The v0.6.0 release changed the API to use Zod validation with a single options object, but:
1. README was not updated
2. No migration guide was provided
3. No deprecation warnings were added

## Required Fixes

### 1. Update ALL README Examples

Every `runLocalCitty` call needs:

```diff
- const result = await runLocalCitty(['--help'], { cwd: './project' })
+ const result = await runLocalCitty({
+   args: ['--help'],
+   cwd: './project',
+   cliPath: 'src/cli.mjs'  // Now required!
+ })
```

### 2. Update Scenario DSL Examples

```diff
- .run('--help', { cwd: './project' })
+ .run({ args: ['--help'], cwd: './project', cliPath: 'src/cli.mjs' })
```

###3. Update Pre-built Scenarios

The `scenarios` helper functions also need updating to pass correct options.

### 4. Add Migration Guide

Create `docs/migration/v0.5.1-to-v0.6.0.md` explaining:
- API signature change
- `cliPath` now required
- How to update existing code
- Why this change was made (Zod validation, fail-fast)

### 5. Consider Backward Compatibility

Option 1: Add overload to support both APIs
```javascript
export function runLocalCitty(argsOrOptions, options) {
  if (Array.isArray(argsOrOptions)) {
    // Old API: runLocalCitty(['--help'], { cwd: './project' })
    return runLocalCittyNew({ args: argsOrOptions, ...options })
  } else {
    // New API: runLocalCitty({ args: ['--help'], cwd: './project' })
    return runLocalCittyNew(argsOrOptions)
  }
}
```

Option 2: Deprecation period
- Support both APIs in v0.6.x
- Show deprecation warning for old API
- Remove old API in v0.7.0

## Affected Files

README sections that need updates:
- Line 76-88: Quick Start
- Line 91-103: Multi-step scenario
- Line 302-314: Local Runner basic
- Line 423-435: Local Runner with options
- Line 532-551: Complete API usage
- Line 584-605: Fluent Assertions
- Line 614-627: Scenario DSL
- Line 787-796: Complete Example local runner
- Line 798-830: Complete Example scenarios
- Line 845-903: Vitest Integration examples

## Testing Status

### Validation Tests Created

- ‚úÖ `playground/test/readme-validation/01-quick-start.test.mjs` - Fixed for v0.6.0 API
- ‚è≥ `playground/test/readme-validation/02-fluent-assertions.test.mjs` - Needs fixing
- ‚è≥ `playground/test/readme-validation/03-scenario-dsl.test.mjs` - Needs fixing
- ‚è≥ `playground/test/readme-validation/04-local-runner.test.mjs` - Needs fixing
- ‚è≥ `playground/test/readme-validation/05-cli-commands.test.mjs` - Needs fixing
- ‚è≥ `playground/test/readme-validation/06-complete-example.test.mjs` - Needs fixing

### Test Results

Running validation tests reveals:
- 35/35 tests fail with v0.6.0 API mismatch
- Error: `Invalid input: expected object, received array`
- This confirms README is completely out of sync with v0.6.0

## Recommendation

### Immediate Actions (v0.6.1 Patch)

1. **Fix README** - Update all examples to v0.6.0 API
2. **Add migration guide** - Help users upgrade from v0.5.1
3. **Update playground** - Fix all example files
4. **Add tests** - Prevent future API doc drift

### Future Actions (v0.7.0)

1. **Consider backward compatibility** - Support both APIs with deprecation
2. **API versioning** - Make breaking changes more visible
3. **Automated README testing** - CI/CD to validate examples
4. **Changelog clarity** - Mark breaking changes prominently

## Priority

**üî¥ CRITICAL** - Users upgrading to v0.6.0 have completely broken examples.

Every single code example in the README will fail with:
```
ZodError: [
  {
    "expected": "object",
    "code": "invalid_type",
    "path": [],
    "message": "Invalid input: expected object, received array"
  }
]
```

## Action Items

- [ ] Update README with v0.6.0 API examples
- [ ] Create migration guide (v0.5.1 ‚Üí v0.6.0)
- [ ] Fix playground example files
- [ ] Update all validation tests
- [ ] Consider backward compatibility wrapper
- [ ] Add deprecation warnings if keeping old API
- [ ] Update CHANGELOG to highlight breaking changes
- [ ] Publish v0.6.1 patch release

---

**Status**: Documentation completely out of sync with v0.6.0 implementation
**Impact**: All users following README examples will encounter errors
**Fix Required**: Update every single `runLocalCitty` example in README
